// Generated by CoffeeScript 1.9.0
(function() {
  var model;

  model = {
    data: {},
    set: function(props) {
      $.extend(true, this.data, props);
      return AutoHUD.render(this.getAll());
    },
    get: function(prop) {
      return this.data[prop];
    },
    getAll: function() {
      return this.data;
    }
  };

  window.AutoHUD = {
    versionPollTime: 5000,
    model: model,
    months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
    init: function(params) {
      if (params.version == null) {
        window.location.reload();
      } else {
        this.version = params.version;
      }
      this.makeTemplates();
      this.versionWatcher = setInterval((function(_this) {
        return function() {
          return _this.fetchVersion();
        };
      })(this), this.versionPollTime);
      return this.watchTime();
    },
    render: function(nextProps) {
      if (this.lastProps != null) {
        if (_.isEqual(this.lastProps, nextProps)) {
          return;
        }
      }
      $("body").html(this.presentationTemplate(nextProps));
      return this.lastProps = $.extend(true, {}, nextProps);
    },
    fetchVersion: function() {
      return $.ajax("/version", {
        type: "GET",
        success: (function(_this) {
          return function(data) {
            return _this.parseVersion(data);
          };
        })(this),
        error: (function(_this) {
          return function() {
            return console.log("no response");
          };
        })(this)
      });
    },
    parseVersion: function(data) {
      if (data.version == null) {
        return;
      }
      if (data.version !== this.version) {
        window.location.reload();
        return;
      }
      return console.log(data);
    },
    watchTime: function() {
      return this.timeWatcher = setInterval((function(_this) {
        return function() {
          return _this.setTime();
        };
      })(this), 1000);
    },
    setTime: function() {
      var d, month, seconds;
      d = new Date();
      seconds = d.getSeconds();
      if (seconds < 10) {
        seconds = "0" + seconds;
      }
      month = this.months[d.getMonth()];
      return this.model.set({
        time: (d.getHours()) + ":" + (d.getMinutes()) + ":" + seconds,
        date: month + " " + (d.getDate()) + ", " + (d.getFullYear())
      });
    },
    makeTemplates: function() {
      return this.presentationTemplate = _.template($("#presentation-template").html());
    }
  };

}).call(this);
